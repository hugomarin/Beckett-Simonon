(function(i,t,e,n){"use strict";Foundation.libs.clearing={name:"clearing",version:"4.0.0",settings:{templates:{viewing:'<a href="#" class="clearing-close">&times;</a>'+'<div class="visible-img" style="display: none"><img src="//:0">'+'<p class="clearing-caption"></p><a href="#" class="clearing-main-left"><span></span></a>'+'<a href="#" class="clearing-main-right"><span></span></a></div>'},close_selectors:".clearing-close",init:false,locked:false},init:function(t,e,n){this.scope=this.scope||t;Foundation.inherit(this,"set_data get_data remove_data throttle");if(typeof e==="object"){n=i.extend(true,this.settings,e)}if(typeof e!="string"){i(this.scope).find("ul[data-clearing]").each(function(){var t=Foundation.libs.clearing,e=i(this),n=n||{},s=t.get_data(e);if(!s){n.$parent=e.parent();t.set_data(e,i.extend(true,t.settings,n));t.assemble(e.find("li"));if(!t.settings.init){t.events().swipe_events()}}});return this.settings.init}else{return this[e].call(this,n)}},events:function(){var e=this;i(this.scope).on("click.fndtn.clearing","ul[data-clearing] li",function(t,n,s){var n=n||i(this),s=s||n,a=e.get_data(n.parent());t.preventDefault();if(!a)e.init();e.open(i(t.target),n,s);e.update_paddles(s)}).on("click.fndtn.clearing",".clearing-main-right",function(i){this.nav(i,"next")}.bind(this)).on("click.fndtn.clearing",".clearing-main-left",function(i){this.nav(i,"prev")}.bind(this)).on("click.fndtn.clearing",this.settings.close_selectors,function(i){Foundation.libs.clearing.close(i,this)}).on("keydown.fndtn.clearing",function(i){this.keydown(i)}.bind(this));i(t).on("resize.fndtn.clearing",function(i){this.resize()}.bind(this));this.settings.init=true;return this},swipe_events:function(){var t=this;i(this.scope).on("touchstart.fndtn.clearing",".visible-img",function(t){if(!t.touches){t=t.originalEvent}var e={start_page_x:t.touches[0].pageX,start_page_y:t.touches[0].pageY,start_time:(new Date).getTime(),delta_x:0,is_scrolling:n};i(this).data("swipe-transition",e);t.stopPropagation()}).on("touchmove.fndtn.clearing",".visible-img",function(e){if(!e.touches){e=e.originalEvent}if(e.touches.length>1||e.scale&&e.scale!==1)return;var n=i(this).data("swipe-transition");if(typeof n==="undefined"){n={}}n.delta_x=e.touches[0].pageX-n.start_page_x;if(typeof n.is_scrolling==="undefined"){n.is_scrolling=!!(n.is_scrolling||Math.abs(n.delta_x)<Math.abs(e.touches[0].pageY-n.start_page_y))}if(!n.is_scrolling&&!n.active){e.preventDefault();var s=n.delta_x<0?"next":"prev";n.active=true;t.nav(e,s)}}).on("touchend.fndtn.clearing",".visible-img",function(t){i(this).data("swipe-transition",{});t.stopPropagation()})},assemble:function(i){var t=i.parent(),e=this.get_data(t),n=t.detach(),s={grid:'<div class="carousel">'+this.outerHTML(n[0])+"</div>",viewing:e.templates.viewing},a='<div class="clearing-assembled"><div>'+s.viewing+s.grid+"</div></div>";return e.$parent.append(a)},open:function(i,t,e){var n=e.closest(".clearing-assembled"),s=n.find("div").first(),a=s.find(".visible-img"),r=a.find("img").not(i);if(!this.locked()){r.attr("src",this.load(i));this.loaded(r,function(){n.addClass("clearing-blackout");s.addClass("clearing-container");a.show();this.fix_height(e).caption(a.find(".clearing-caption"),i).center(r).shift(t,e,function(){e.siblings().removeClass("visible");e.addClass("visible")})}.bind(this))}},close:function(t,e){t.preventDefault();var n=function(i){if(/blackout/.test(i.selector)){return i}else{return i.closest(".clearing-blackout")}}(i(e)),s,a;if(e===t.target&&n){s=n.find("div").first(),a=s.find(".visible-img");this.settings.prev_index=0;n.find("ul[data-clearing]").attr("style","").closest(".clearing-blackout").removeClass("clearing-blackout");s.removeClass("clearing-container");a.hide()}return false},keydown:function(t){var e=i(".clearing-blackout").find("ul[data-clearing]");if(t.which===39)this.go(e,"next");if(t.which===37)this.go(e,"prev");if(t.which===27)i("a.clearing-close").trigger("click")},nav:function(t,e){var n=i(".clearing-blackout").find("ul[data-clearing]");t.preventDefault();this.go(n,e)},resize:function(){var t=i(".clearing-blackout .visible-img").find("img");if(t.length){this.center(t)}},fix_height:function(t){var e=t.parent().children(),n=this;e.each(function(){var t=i(this),e=t.find("img");if(t.height()>n.outerHeight(e)){t.addClass("fix-height")}}).closest("ul").width(e.length*100+"%");return this},update_paddles:function(i){var t=i.closest(".carousel").siblings(".visible-img");if(i.next().length){t.find(".clearing-main-right").removeClass("disabled")}else{t.find(".clearing-main-right").addClass("disabled")}if(i.prev().length){t.find(".clearing-main-left").removeClass("disabled")}else{t.find(".clearing-main-left").addClass("disabled")}},center:function(i){i.css({marginLeft:-(this.outerWidth(i)/2),marginTop:-(this.outerHeight(i)/2)});return this},load:function(i){var t=i.parent().attr("href");this.preload(i);if(t)return t;return i.attr("src")},preload:function(i){this.img(i.closest("li").next()).img(i.closest("li").prev())},loaded:function(i,t){function e(){t()}function n(){this.one("load",e);if(/MSIE (\d+\.\d+);/.test(navigator.userAgent)){var i=this.attr("src"),t=i.match(/\?/)?"&":"?";t+="random="+(new Date).getTime();this.attr("src",i+t)}}if(!i.attr("src")){e();return}if(this.complete||this.readyState===4){e()}else{n.call(i)}},img:function(i){if(i.length){var t=new Image,e=i.find("a");if(e.length){t.src=e.attr("href")}else{t.src=i.find("img").attr("src")}}return this},caption:function(i,t){var e=t.data("caption");if(e){i.text(e).show()}else{i.text("").hide()}return this},go:function(i,t){var e=i.find(".visible"),n=e[t]();if(n.length){n.find("img").trigger("click",[e,n])}},shift:function(i,t,e){var n=t.parent(),s=this.settings.prev_index||t.index(),a=this.direction(n,i,t),r=parseInt(n.css("left"),10),l=this.outerWidth(t),c;if(t.index()!==s&&!/skip/.test(a)){if(/left/.test(a)){this.lock();n.animate({left:r+l},300,this.unlock())}else if(/right/.test(a)){this.lock();n.animate({left:r-l},300,this.unlock())}}else if(/skip/.test(a)){c=t.index()-this.settings.up_count;this.lock();if(c>0){n.animate({left:-(c*l)},300,this.unlock())}else{n.animate({left:0},300,this.unlock())}}e()},direction:function(t,e,n){var s=t.find("li"),a=this.outerWidth(s)+this.outerWidth(s)/4,r=Math.floor(this.outerWidth(i(".clearing-container"))/a)-1,l=s.index(n),c;this.settings.up_count=r;if(this.adjacent(this.settings.prev_index,l)){if(l>r&&l>this.settings.prev_index){c="right"}else if(l>r-1&&l<=this.settings.prev_index){c="left"}else{c=false}}else{c="skip"}this.settings.prev_index=l;return c},adjacent:function(i,t){for(var e=t+1;e>=t-1;e--){if(e===i)return true}return false},lock:function(){this.settings.locked=true},unlock:function(){this.settings.locked=false},locked:function(){return this.settings.locked},outerHTML:function(i){return i.outerHTML||(new XMLSerializer).serializeToString(i)},off:function(){i(this.scope).off(".fndtn.clearing");i(t).off(".fndtn.clearing");this.remove_data();this.settings.init=false}}})(Foundation.zj,this,this.document);